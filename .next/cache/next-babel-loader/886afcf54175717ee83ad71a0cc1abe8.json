{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Link from 'next/link';\nimport { useState, useEffect } from 'react';\nimport fetch from 'isomorphic-unfetch';\nimport { useRouter, withRouter } from 'next/router';\nimport Router from 'next/router';\nimport Head from 'next/head';\nimport { Form } from 'react-bootstrap';\nimport { Label } from 'semantic-ui-react'; //Toast\n\nimport { ToastContainer, toast } from 'react-toastify'; //Image resize\n\nimport Resizer from 'react-image-file-resizer';\n\nconst fileUpload = require('fuctbase64');\n\nconst NewBook = withRouter(({\n  router: {\n    query: {\n      name,\n      id,\n      firstname,\n      userEmail\n    }\n  }\n}) => {\n  const {\n    0: form,\n    1: setForm\n  } = useState({\n    title: '',\n    author: '',\n    ownerID: '',\n    ownerName: '',\n    imageFront: '',\n    price: '',\n    userEmail: '',\n    postedOn: ''\n  });\n  const {\n    0: isSubmitting,\n    1: setIsSubmitting\n  } = useState(false);\n  const {\n    0: errors,\n    1: setErrors\n  } = useState({}); //state of the preview image\n\n  const {\n    0: prevImage,\n    1: setPrevImage\n  } = useState('/static/default-image.svg');\n  const router = useRouter();\n  console.log('userEmail is ', userEmail); // Get current date\n\n  var date = new Date().getDate();\n  var year = new Date().getFullYear(); //Get day\n\n  var day;\n\n  switch (new Date().getDay()) {\n    case 0:\n      day = \"Sunday\";\n      break;\n\n    case 1:\n      day = \"Monday\";\n      break;\n\n    case 2:\n      day = \"Tuesday\";\n      break;\n\n    case 3:\n      day = \"Wednesday\";\n      break;\n\n    case 4:\n      day = \"Thursday\";\n      break;\n\n    case 5:\n      day = \"Friday\";\n      break;\n\n    case 6:\n      day = \"Saturday\";\n  } //Get mobth\n\n\n  var month;\n\n  switch (new Date().getMonth()) {\n    case 0:\n      month = \"December\";\n      break;\n\n    case 1:\n      month = \"January\";\n      break;\n\n    case 2:\n      month = \"March\";\n      break;\n\n    case 3:\n      month = \"April\";\n      break;\n\n    case 4:\n      month = \"May\";\n      break;\n\n    case 5:\n      month = \"June\";\n      break;\n\n    case 6:\n      month = \"July\";\n\n    case 6:\n      month = \"July\";\n\n    case 7:\n      month = \"August\";\n\n    case 8:\n      month = \"September\";\n\n    case 9:\n      month = \"October\";\n\n    case 10:\n      month = \"November\";\n\n    case 11:\n      month = \"December\";\n  }\n\n  var DayDateMonth = \"\" + day + \" \" + date + \" \" + month + \" \" + year;\n  useEffect(() => {\n    if (isSubmitting) {\n      if (Object.keys(errors).length === 0) {\n        //bookmatch();\n        //alert('New book created')\n        createBook();\n        /*\n        Router.push({\n            pathname: '/booklist',\n            query: { \n                    mytitle: form.title,\n                    author: form.author\n                    \n            }\n        });*/\n      } else {\n        setIsSubmitting(false);\n      }\n    }\n  }, [errors]); //Create new book post\n\n  const createBook = async () => {\n    try {\n      // notify function\n      notify(); //const res = await fetch('http://localhost:3000/api/books', {\n\n      const res = await fetch('https://usedbooksexchange.com/api/books', {\n        method: 'POST',\n        headers: {\n          \"Accept\": 'application/json',\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(form)\n      }); // notify function\n\n      notifyDone(); //Redirect to my profile\n\n      Router.push({\n        pathname: '/myprofile',\n        query: {\n          mytitle: '',\n          author: '',\n          name: name,\n          id: id,\n          firstname: firstname,\n          userEmail: userEmail\n        }\n      }, '/myprofile');\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    console.log(form.imageFront);\n    setForm(_objectSpread(_objectSpread({}, form), {}, {\n      ownerID: id,\n      ownerName: name,\n      userEmail: userEmail,\n      postedOn: DayDateMonth\n    }));\n    let errs = validate();\n    setErrors(errs);\n    setIsSubmitting(true);\n  };\n\n  const handleChange = e => {\n    setForm(_objectSpread(_objectSpread({}, form), {}, {\n      [e.target.name]: e.target.value\n    }));\n  };\n\n  const validate = () => {\n    let err = {};\n    return err;\n  }; //Handle page switch for header icons\n\n\n  const myProfile = () => {\n    Router.push({\n      pathname: '/myprofile',\n      query: {\n        mytitle: '',\n        author: '',\n        name: name,\n        id: id,\n        firstname: firstname,\n        userEmail: userEmail\n      }\n    }, '/myprofile');\n  }; //Go to section to create new listing\n\n\n  const myBooks = () => {\n    Router.push({\n      pathname: '/new',\n      query: {\n        id: id,\n        name: name,\n        firstname: firstname,\n        userEmail: userEmail\n      }\n    }, '/new');\n  };\n\n  const Search = () => {\n    Router.push({\n      pathname: '/posts',\n      query: {\n        id: id,\n        name: name,\n        firstname: firstname,\n        userEmail: userEmail\n      }\n    }, '/search');\n  }; //Handle image upload\n\n\n  const image1Upload = e => {\n    var fileInput = false;\n\n    if (e.target.files[0]) {\n      fileInput = true;\n    }\n\n    if (fileInput) {\n      Resizer.imageFileResizer(event.target.files[0], 300, 300, 'png', 100, 0, uri => {\n        console.log(uri); //Update form with new image data\n\n        setForm(_objectSpread(_objectSpread({}, form), {}, {\n          imageFront: {\n            data: uri,\n            contentType: 'image/png'\n          }\n        })); //Update image preview\n\n        setPrevImage(uri);\n      }, 'base64');\n    }\n  };\n\n  const aboutUs = () => {\n    Router.push({\n      pathname: '/aboutus',\n      query: {\n        id: id,\n        name: name,\n        firstname: firstname,\n        userEmail: userEmail\n      }\n    });\n  }; //Toast functions\n\n\n  const notify = () => toast(\"Adding new post\");\n\n  const notifyDone = () => toast(\"Post added\");\n\n  return __jsx(\"div\", {\n    className: \"newBook-page\"\n  }, __jsx(Head, null, __jsx(\"title\", null, \"Create post, MacEwan Book Trade\")), __jsx(\"div\", {\n    className: \"book-greeting\"\n  }, __jsx(\"div\", {\n    className: \"greeting-text\"\n  }, __jsx(\"div\", {\n    className: \"icon-box\"\n  }, __jsx(Link, {\n    href: \"/\"\n  }, __jsx(\"img\", {\n    src: \"/icons/sign-out.png\",\n    alt: \"my image\",\n    className: \"my-icon\"\n  })), __jsx(\"img\", {\n    onClick: aboutUs,\n    src: \"/icons/info.svg\",\n    alt: \"About us\",\n    className: \"my-icon btn-aboutUs\"\n  }), __jsx(\"div\", {\n    className: \"my-icon-end\"\n  }, __jsx(\"img\", {\n    src: \"/icons/four-square.png\",\n    alt: \"my books\",\n    className: \"my-icon\",\n    onClick: myProfile\n  }), __jsx(\"img\", {\n    src: \"/icons/plus.png\",\n    alt: \"Add book\",\n    className: \"my-icon\",\n    onClick: myBooks\n  }), __jsx(\"img\", {\n    src: \"/icons/search.png\",\n    alt: \"Search\",\n    className: \"my-icon\",\n    onClick: Search\n  }))), __jsx(\"div\", {\n    style: {\n      marginTop: '65px',\n      fontSize: '18px',\n      textAlign: 'center',\n      width: '100%'\n    }\n  }, __jsx(\"p\", null, \"Add a new book posting.\")))), __jsx(\"form\", {\n    className: \"create-book-form\",\n    onSubmit: handleSubmit,\n    style: {\n      marginTop: '10%'\n    }\n  }, __jsx(\"img\", {\n    src: prevImage,\n    alt: \"default-image\",\n    className: \"image-preview\"\n  }), __jsx(\"div\", {\n    className: \"form-group my-group\",\n    style: {\n      marginTop: '8%'\n    }\n  }, __jsx(\"input\", {\n    type: \"text\",\n    className: \"form-control new-book-input\",\n    id: \"exampleInputEmail1\",\n    placeholder: \"Enter book title\",\n    name: \"title\",\n    required: true,\n    onChange: handleChange\n  })), __jsx(\"div\", {\n    className: \"form-group my-group\"\n  }, __jsx(\"input\", {\n    type: \"text\",\n    className: \"form-control new-book-input\",\n    placeholder: \"Enter Author\",\n    name: \"author\",\n    onChange: handleChange,\n    required: true\n  }), __jsx(\"input\", {\n    type: \"text\",\n    className: \"form-control new-book-input\",\n    placeholder: \"Price\",\n    name: \"price\",\n    style: {\n      marginTop: '5%'\n    },\n    onChange: handleChange,\n    required: true\n  }), __jsx(\"label\", {\n    className: \"input-file-btn\"\n  }, __jsx(\"input\", {\n    type: \"file\",\n    name: \"file\",\n    id: \"input-files\",\n    className: \"input-file-btn\",\n    onChange: image1Upload\n  })), __jsx(\"label\", {\n    htmlFor: \"file-upload\",\n    className: \"input-file-btn\"\n  }), __jsx(\"button\", {\n    type: \"submit\",\n    className: \"btn btn-primary my-btn\"\n  }, \"POST\"))), __jsx(ToastContainer, null));\n});\nexport default NewBook;","map":null,"metadata":{},"sourceType":"module"}